---
title: "epicov_pre_iot"
author: "Matheus"
date: "23/08/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Projeto EPICOV - CNAF/VNI

```{r #Definindo os data frames, include=FALSE}
library(tidyverse)
library(readxl)
library(skimr)
df <- read_excel("../epicov_inicial.xlsx")
## Definindo o data frame apenas com paciente que usaram VNI e/ou CNAF pré-IOT
df_pre <- filter(df, `Usou VNI pre IOT?` == "Yes" | `Usou CNAF pre IOT?` == "Yes")
## Data frame apenas com paciente que não usaram VNI/CNAF pré-IOT
df_npre <- filter(df, `Usou VNI pre IOT?` == "No" & `Usou CNAF pre IOT?` == "No")
## Data total com coluna de grupos
df_pre$Grupo <- c("Int")
df_npre$Grupo <- c("Controle")
df_pret <- rbind(df_pre, df_npre)
```

## Análise descritiva/exploratória

### Idade grupo CNAF/VNI
```{r #Análise exploratória - Idade}
as.data.frame(skim(df_pre$Idade))
```

### Idade grupo controle
```{r}
as.data.frame(skim(df_npre$Idade))
```

### Teste de normalidade
```{r}
#Grupo Intervenção
shapiro.test(df_pre$Idade)
shapiro.test(df_npre$Idade)
```
#### Concluímos que ambas as amostras possuem distribuição não-paramétrica.

### Comparação Idade
```{r}
ggplot(df_pret, aes(Idade, fill=Grupo)) +
  geom_density(alpha=0.2)
wilcox.test(df_pre$Idade, df_npre$Idade)
```
#### Conclusão: Não há diferença entre ambos os grupos.

### Comparação - Sexo

#### Sexo - grupo intervenção

```{r}
as.data.frame(skim(df_pre$Sexo))
table(df_pre$Sexo)
prop.table(table(df_pre$Sexo))
ggplot(data=df_pre, aes(x=Sexo, y=(..count..)*100/sum(..count..), fill=Sexo))+
  geom_bar()
```

#### Sexo- grupo controle

```{r}
as.data.frame(skim(df_npre$Sexo))
table(df_npre$Sexo)
prop.table(table(df_npre$Sexo))
ggplot(data=df_npre, aes(x=Sexo, y=(..count..)*100/sum(..count..), fill=Sexo))+
  geom_bar()
```
#### Comparação - Sexo

```{r}
t1 <- select(df_pre, Sexo, Grupo)
t1
t2 <- select(df_npre, Sexo, Grupo)
t2
t3 <- rbind(t1, t2)
chisq.test(table(t3))
```

#### Não observamos diferença estatísticamente significativa entre ambos os grupos, porém, o valor de "p" quase atinge o limite.

### Comparação IMC

#### IMC - Grupo CnAF/VNI

```{r}
as.data.frame(skim(df_pre$IMC))
ggplot(data=df_pre, aes(x=IMC))+
  geom_density()
```

#### IMC - Grupo controle
```{r}
as.data.frame(skim(df_npre$IMC))
ggplot(data=df_npre, aes(x=IMC))+
  geom_density()
```

#### Comparação
```{r}
ggplot(data=df_pret, aes(x=IMC, fill=Grupo)) +
  geom_density(alpha=0.2)
shapiro.test(df_pre$IMC)
shapiro.test(df_npre$IMC)
wilcox.test(df_pre$IMC, df_npre$IMC)
```

#### Ambos os grupos possuem distribuição não-paramétrica. Conclusão: Diferença estatísticamente significativa?!

### Comparação início dos sintomas - internação hospiptalar

#### Grupo CnAF/VNI

```{r}
as.data.frame(skim(df_pre$`Data do início dos sintomas`))
as.data.frame(skim(df_pre$`Data de admissão hospitalar no HC`))
mean(difftime(df_pre$`Data de admissão hospitalar no HC`, df_pre$`Data do início dos sintomas`, units = "days"))
```

#### Grupo controle
```{r}
as.data.frame(skim(df_npre$`Data do início dos sintomas`))
as.data.frame(skim(df_npre$`Data de admissão hospitalar no HC`))
mean(difftime(df_npre$`Data de admissão hospitalar no HC`, df_npre$`Data do início dos sintomas`, units = "days"))
```


### Início dos sintomas - Internação UTI

#### Grupo CnAF/VNI

```{r}
as.data.frame(skim(df_pre$`Data do início dos sintomas`))
as.data.frame(skim(df_pre$`Data de admissão UTI`))
mean(difftime(df_pre$`Data de admissão UTI`, df_pre$`Data do início dos sintomas`, units = "days"))
```

#### Grupo controle
```{r}
as.data.frame(skim(df_npre$`Data do início dos sintomas`))
as.data.frame(skim(df_npre$`Data de admissão UTI`))
mean(difftime(df_npre$`Data de admissão UTI`, df_npre$`Data do início dos sintomas`, units = "days"))
```

### Internação hospitalar - internação UTI

#### Grupo CnAF/VNI

```{r}
as.data.frame(skim(df_pre$`Data de admissão hospitalar no HC`))
as.data.frame(skim(df_pre$`Data de admissão UTI`))
mean(difftime(df_pre$`Data de admissão UTI`, df_pre$`Data de admissão hospitalar no HC`, units = "days"))
```

#### Grupo controle

```{r}
as.data.frame(skim(df_npre$`Data de admissão hospitalar no HC`))
as.data.frame(skim(df_npre$`Data de admissão UTI`))
mean(difftime(df_npre$`Data de admissão UTI`, df_npre$`Data de admissão hospitalar no HC`, units = "days"))
```